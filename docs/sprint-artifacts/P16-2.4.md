# Story P16-2.4: Add Live View Button to Camera Cards

Status: done

## Story

As a **user**,
I want **a "Live View" button on Protect camera cards**,
So that **I can quickly access live streams**.

## Acceptance Criteria

1. **Given** I am on the Cameras page viewing Protect cameras
   **When** I see a Protect camera card
   **Then** there is a "Live View" button with a video icon

2. **Given** I click the Live View button
   **When** the action triggers
   **Then** a modal opens with the LiveStreamPlayer component
   **And** the modal shows the camera name in the header
   **And** the modal can be closed with X button or Escape key

3. **Given** the camera is offline or stream unavailable
   **When** I click Live View
   **Then** the modal opens with the snapshot fallback view
   **And** a message indicates "Live stream unavailable - showing snapshots"

4. **And** Live View button only appears on Protect cameras (not RTSP/USB)

## Tasks / Subtasks

- [x] Task 1: Create LiveStreamModal component (AC: 2, 3)
  - [x] Create `frontend/components/streaming/LiveStreamModal.tsx`
  - [x] Use shadcn/ui Dialog for modal
  - [x] Include LiveStreamPlayer component
  - [x] Show camera name in header
  - [x] Handle X button and Escape key to close
  - [x] Show fallback message when stream unavailable

- [x] Task 2: Add Live View button to CameraPreview (AC: 1, 4)
  - [x] Modify `frontend/components/cameras/CameraPreview.tsx`
  - [x] Add Video icon from lucide-react
  - [x] Only show for Protect cameras (source_type === 'protect')
  - [x] Add onClick handler to open modal
  - [x] Update arePropsEqual for new prop

- [x] Task 3: Export and integrate components
  - [x] Update `frontend/components/streaming/index.ts` exports
  - [x] Add modal state management to CameraPreview

- [x] Task 4: Write tests (AC: all)
  - [x] Unit tests for LiveStreamModal
  - [x] Update CameraPreview tests for Live View button
  - [x] Test modal opens/closes correctly

## Dev Notes

### Technical Context

- **Epic**: P16-2 - Live Camera Streaming
- **GitHub Issue**: #358
- **FRs Covered**: FR16, FR17, FR18
- **Prerequisites**: P16-2.3 (LiveStreamPlayer component) ✅

### Implementation Approach

**LiveStreamModal Component:**
- Use shadcn/ui Dialog (already available in project)
- Embed LiveStreamPlayer component from P16-2.3
- Pass cameraId and cameraName props
- Handle modal open/close state

### Component Structure

```
CameraPreview
├── Live View Button (Protect only)
│   └── onClick → opens LiveStreamModal
│
LiveStreamModal
├── Dialog from shadcn/ui
├── Header with camera name + close button
├── LiveStreamPlayer component
└── Fallback message (when stream unavailable)
```

### Existing Components to Use

From P16-2.3:
- `LiveStreamPlayer` - Main streaming component with fallback support
- `StreamQualitySelector` - Quality dropdown (embedded in LiveStreamPlayer)

From shadcn/ui:
- `Dialog`, `DialogContent`, `DialogHeader`, `DialogTitle` - Modal components

### Project Structure Notes

- Modify: `frontend/components/cameras/CameraPreview.tsx` (add Live View button)
- New: `frontend/components/streaming/LiveStreamModal.tsx`
- Modify: `frontend/components/streaming/index.ts` (add export)

### Learnings from Previous Story

**From Story P16-2.3 (Status: done)**

- `LiveStreamPlayer` accepts: `cameraId`, `cameraName`, `className`, `initialQuality`, `aspectRatio`, `showControls`
- Snapshot fallback automatically activates after 5s WebSocket timeout
- Component is wrapped with React.memo for performance
- All streaming API methods available in `apiClient.cameras`

[Source: docs/sprint-artifacts/P16-2.3.md#Completion-Notes-List]

### References

- [Source: docs/epics-phase16.md#Story-P16-2.4]
- [Source: docs/sprint-artifacts/P16-2.3.md - LiveStreamPlayer implementation]
- [Source: frontend/components/cameras/CameraPreview.tsx - Current camera card]

## Dev Agent Record

### Context Reference

<!-- Path(s) to story context XML will be added here by context workflow -->

### Agent Model Used

Claude Opus 4.5

### Debug Log References

### Completion Notes List

- LiveStreamModal uses shadcn/ui Dialog with showCloseButton={true} for X button
- Modal closes on Escape key via Dialog's built-in onOpenChange handler
- Live View button only renders for Protect cameras (isProtect check)
- LiveStreamPlayer shows snapshot fallback automatically when WebSocket fails
- CameraPreview uses useState/useCallback for modal state management
- 9 new tests for LiveStreamModal, 4 new tests for CameraPreview Live View button
- All 32 tests pass (9 LiveStreamModal + 23 CameraPreview)

### File List

- `frontend/components/streaming/LiveStreamModal.tsx` (NEW)
- `frontend/components/streaming/index.ts` (MODIFIED)
- `frontend/components/cameras/CameraPreview.tsx` (MODIFIED)
- `frontend/__tests__/components/streaming/LiveStreamModal.test.tsx` (NEW)
- `frontend/__tests__/components/cameras/CameraPreview.test.tsx` (MODIFIED)

## Change Log

| Date | Change | Author |
|------|--------|--------|
| 2026-01-01 | Story created | Claude Code |
| 2026-01-01 | Story completed | Claude Code |
